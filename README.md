# Melody - Dependency Manager for Go

Melody is a tool that enables Go developers to manage project's dependencies and ensure fast, consistent, and repeatable builds.  We've adopted the [following principles](#credits-and-inspiration) to make this happen:

**All dependencies are vendored** to prevent multiple projects from clobbering shared repositories in GOPATH.

**Human-friendly config file** explicitly specifies project details and dependencies with corresponding version restrictions.

**Human-readable lock file** to record and track exact revision of each installed repository.  This file is used to deterministically recreate the `vendor` directory.

**Cloud-assisted repository indexing and caching** allows for much faster and more-reliable builds.  [melodyAPI][melody-api] integration makes sure your build is fast, and that a deleted repository or tag does not break future builds.

> Please note that the [melodyAPI][melody-api] cloud cache may be cold during the beta period due to a low traffic.  This may cause slowness during your installs, but it will get faster as our userbase grows.

Melody requires Go 1.6+. Although it may work with GO15VENDOREXPERIMENT flag, Go 1.5 is not supported.

## Installing Melody

Binary builds are available in the [Releases][releases] section of Melody GitHub repo.  For the latest unstable version, you can also [build from source](#building-from-source).

## Usage

Melody only needs a few simple commands to deliver a lot of power. To get started, please  <s>run [`melody init`](#contribution-and-improvements)</s> manually create a [`Melody.toml`](#melodytoml) file and run `melody install`.   All required repositories will be installed into the project's `vendor` subdirectory.

### Commands

    melody install

If you're running this command for the first time, Melody will resolve the dependency graph via [melodyAPI][melody-api] and install the latest possible versions of each repository into the `vendor` subdirectory.  It will also save the current state in the [`Melody.lock`](#melodylock) file.

Locking dependency versions in `Melody.lock` ensures that subsequent executions of the `install` command will recreate the `vendor` subdirectory with exactly the same versions of each dependency.  Whenever you try to recreate a project build, you should start with this command to return the project to the locked state.

If you would like to update a particular dependency in the future, you can run:

    melody update github.com/gin-gonic/gin

This command will try to make minimal changes to your lockfile while updating that particular dependency.  But if you're feeling adventurous and would like to update everything, run:

    melody update

Also, you can peek at available updates without making any changes:

    melody outdated

That's it, for now.  Subsequent building and testing can be done via standard Go toolchain.

## Project layout

Melody integrates with the standard $GOPATH layout that you've been using, you just need to add `Melody.{toml|lock}` files at the root of your project:

    $GOPATH/src/path/to/project
    ├── Melody.lock
    ├── Melody.toml
    ├── main.go
    └── ...

### Melody.toml

Both configuration and lockfile are in [TOML][toml] configuration format.  Please take a look at [`Melody.toml`][example-config] for this repository for an example with inline documentation on how to get started.

### Melody.lock

The lockfile is auto-generated and should not be modified by hand.  We highly recommend committing this file into your repository to enable repeatable outcome of `melody install`.

### Specifying dependency restrictions

When you specify dependencies in `Melody.toml`, you can restrict to a range or an exact version/revision that Melody should install.  These versions are extracted from repository's [SemVer][semver]-compatible tags or auto-generated by melodyAPI.  We support the following dependency restrictions:

- `""` or `"*"` specifies the latest tagged release version
- `"head"` specifies the latest possible revision in main branch
- `"1.2.3"` will only install a specific version (tagged or auto-generated)
- `"#sha"` will install a specific revision of the repo
- You can also use ranges similar to [npm-semver](https://github.com/npm/node-semver#ranges)
- TODO: Expand SemVer range docs here

### Importing local dependencies

If you would like to import a package from another local repository, unfortunately at this time Melody cannot help you. Instead, we suggest temporarily removing that dependency from your `Melody.toml` and `vendor` subdirectory, and letting Go toolchain reference that local dependency via GOPATH.  Once you've pushed the local changes to the origin server, you can return to vendoring that dependency via Melody.

## Contribution and Improvements

We encourage you to contribute to Melody! The current iteration of Melody is just a preview of what it could be.  We would like to add the following in the near future:

- <s>`init` command to initialize a project with a basic `Melody.toml`</s>
- <s>`lint` command to validate configuration and dependencies</s>
- `init` should be smarter about creating projects in $GOPATH/src
- Auto-extract and validate dependencies in `init` and `lint`
- Skip "Resolving" step for `install` with an existing lockfile.
- Support for `[test-dependencies]` group in `Melody.toml`
- Batch GraphQL queries for package info from melodyAPI
- Better error handling and messaging
- Clean-up and document public API 
- More tests

### Building from source

Although you can use `go get` to install Melody, we, of course, recommend using Melody to prepare the project: 

```bash
$ git clone https://github.com/melody-sh/melody.git
$ cd melody; melody install
$ make build
```

### Running tests

Once you have all the requirements to build Melody, you can run the tests after populating the test data:

```bash
$ make install
$ make test
```

### Submitting updates

If you would like to contribute to this project, just do the following:

1. Fork the repo on Github.
2. Add your features and make commits to your forked repo.
3. Make a pull request to this repo.
4. Review will be done and changes will be requested.
5. Once changes are done or no changes are required, pull request will be merged.
6. The next release will have your changes in it.

Please take a look at the issues page if you want to get started.

If you think it would be nice to have a particular feature that is presently not implemented, we would love to hear your ideas and consider working on it.  Just open an issue in Github.

## Credits and inspiration

Aside from the dependencies specified in the `Melody.toml` file that make Melody possible, we drew ideas, inspiration, and sometimes ported code directly from:

- [Bundler](http://bundler.io) - Ruby dependency manager
- [Cargo](http://doc.crates.io) - Rust dependency manager
- [Composer](https://getcomposer.org) - PHP dependency manager

Melody was started as an internal project at [Gemfury](https://gemfury.com), and the company will continue to sponsor its maintenance and future development.

## Questions

Please use the [tag "melody" on StackOverflow][questions] or [file a Github Issue][issues] if you have any other questions or problems.

## License

Melody is Copyright © 2016 Michael Rykov. See LICENSE file for terms of use and redistribution.

[questions]: http://stackoverflow.com/questions/ask?tags=melody
[releases]: https://github.com/melody-sh/melody/releases
[issues]: https://github.com/melody-sh/melody/issues
[example-config]: https://github.com/melody-sh/melody/blob/master/Melody.toml
[toml]: https://github.com/toml-lang/toml
[melody-api]: https://melody.sh/api/
[semver]: http://semver.org
